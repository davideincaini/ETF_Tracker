(function(){"use strict";function d(o=0,c=1){const s=Math.random(),i=Math.random(),n=Math.sqrt(-2*Math.log(s))*Math.cos(2*Math.PI*i);return o+n*c}function y(o,c=[10,25,50,75,90]){if(o.length===0)return{};const s=[...o].sort((n,a)=>n-a),i={};for(const n of c){const a=Math.ceil(n/100*s.length)-1;i[`p${n}`]=s[Math.max(0,a)]}return i}function V(o){const{portfolioWeights:c,assetStats:s,timeHorizonYears:i,monthlyContribution:n,currentValue:a}=o,M=i*12;let u=a;const p=[u];for(let e=0;e<M;e++){u+=n;let h=0;for(const[g,S]of Object.entries(c)){const m=s[g];if(!m)continue;const r=m.meanReturn/12,t=m.volatility/Math.sqrt(12),l=d(r,t);h+=S*l}u*=1+h,p.push(u)}return{finalValue:u,timeline:p}}self.onmessage=function(o){const{type:c,params:s}=o.data;if(c==="RUN_SIMULATIONS"){const{portfolioWeights:i,assetStats:n,timeHorizonYears:a,monthlyContribution:M,currentValue:u,numSimulations:p=1e4}=s,e=[],h=[],g=Math.min(100,p);for(let t=0;t<p;t++){const l=V({portfolioWeights:i,assetStats:n,timeHorizonYears:a,monthlyContribution:M,currentValue:u});e.push(l.finalValue),t<g&&h.push(l.timeline),(t+1)%1e3===0&&self.postMessage({type:"PROGRESS",progress:(t+1)/p})}const S=y(e),m=a*12,r={p10:[],p25:[],p50:[],p75:[],p90:[]};for(let t=0;t<=m;t++){const l=h.map(R=>R[t]),f=y(l);r.p10.push(f.p10),r.p25.push(f.p25),r.p50.push(f.p50),r.p75.push(f.p75),r.p90.push(f.p90)}self.postMessage({type:"COMPLETE",results:{finalValues:e,percentiles:S,percentileTimelines:r,mean:e.reduce((t,l)=>t+l,0)/e.length,min:Math.min(...e),max:Math.max(...e)}})}}})();
